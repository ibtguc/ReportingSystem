@page
@model ReportingSystem.Pages.Admin.Reports.CreateModel
@{
    ViewData["Title"] = "Create Report";
}

<div class="container mt-4">
    <div class="row">
        <div class="col-lg-8 offset-lg-2">
            <div class="card shadow-sm">
                <div class="card-header">
                    <h4 class="mb-0"><i class="bi bi-file-earmark-plus"></i> Create New Report</h4>
                </div>
                <div class="card-body">
                    <p class="text-muted">Select a template, period, and user to create a new report.</p>

                    <form method="post">
                        <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

                        <div class="mb-3">
                            <label class="form-label">Report Template *</label>
                            <select asp-for="SelectedTemplateId" asp-items="Model.TemplateOptions" class="form-select" id="templateSelect">
                                <option value="">-- Select Template --</option>
                            </select>
                            <span asp-validation-for="SelectedTemplateId" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Report Period *</label>
                            @if (Model.PeriodOptions.Count > 0)
                            {
                                <select asp-for="SelectedPeriodId" asp-items="Model.PeriodOptions" class="form-select">
                                    <option value="">-- Select Period --</option>
                                </select>
                            }
                            else
                            {
                                <select asp-for="SelectedPeriodId" class="form-select" disabled>
                                    <option value="">@(Model.SelectedTemplateId > 0 ? "No open periods available" : "Select a template first")</option>
                                </select>
                                <div class="form-text text-warning">
                                    @if (Model.SelectedTemplateId > 0)
                                    {
                                        <text>No open periods available for this template. Create a period and set it to "Open" first.</text>
                                    }
                                </div>
                            }
                            <span asp-validation-for="SelectedPeriodId" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Report Author *</label>
                            <select asp-for="SelectedUserId" asp-items="Model.UserOptions" class="form-select">
                                <option value="">-- Select User --</option>
                            </select>
                            <span asp-validation-for="SelectedUserId" class="text-danger"></span>
                        </div>

                        <div class="d-flex justify-content-between mt-4">
                            <a asp-page="Index" class="btn btn-secondary">
                                <i class="bi bi-arrow-left"></i> Cancel
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-file-earmark-plus"></i> Create & Fill Report
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Reload page when template changes to get correct periods
        document.getElementById('templateSelect')?.addEventListener('change', function() {
            var templateId = this.value;
            if (templateId) {
                window.location.href = '?templateId=' + templateId;
            }
        });
    </script>
}
