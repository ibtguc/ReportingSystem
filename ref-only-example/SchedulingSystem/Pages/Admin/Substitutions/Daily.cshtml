@page
@model SchedulingSystem.Pages.Admin.Substitutions.DailyModel
@using SchedulingSystem.Models
@{
    ViewData["Title"] = "Daily Substitution Board";
    var previousDay = Model.SelectedDate.AddDays(-1);
    var nextDay = Model.SelectedDate.AddDays(1);
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2><i class="bi bi-calendar-check"></i> Daily Substitution Board</h2>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/Admin/Dashboard">Dashboard</a></li>
                            <li class="breadcrumb-item active">Daily Board</li>
                        </ol>
                    </nav>
                </div>
                <div>
                    <a href="/Admin/Absences/Report" class="btn btn-primary">
                        <i class="bi bi-plus-circle"></i> Report Absence
                    </a>
                    <a href="/Admin/Absences" class="btn btn-outline-primary">
                        <i class="bi bi-list"></i> All Absences
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Date Navigation -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <div class="row align-items-center">
                <div class="col-md-4">
                    <a href="?date=@previousDay.ToString("yyyy-MM-dd")" class="btn btn-outline-secondary">
                        <i class="bi bi-chevron-left"></i> Previous Day
                    </a>
                </div>
                <div class="col-md-4 text-center">
                    <h4 class="mb-0">
                        @Model.SelectedDate.ToString("dddd, MMMM dd, yyyy")
                    </h4>
                    <form method="get" class="mt-2">
                        <div class="input-group input-group-sm d-inline-flex" style="width: auto;">
                            <input type="date" name="date" class="form-control" value="@Model.SelectedDate.ToString("yyyy-MM-dd")" />
                            <button type="submit" class="btn btn-primary">Go</button>
                        </div>
                    </form>
                </div>
                <div class="col-md-4 text-end">
                    <a href="?date=@nextDay.ToString("yyyy-MM-dd")" class="btn btn-outline-secondary">
                        Next Day <i class="bi bi-chevron-right"></i>
                    </a>
                </div>
            </div>
            <div class="mt-3 text-center">
                <a href="?date=@DateTime.Today.ToString("yyyy-MM-dd")" class="btn btn-sm btn-info">
                    <i class="bi bi-calendar-day"></i> Today
                </a>
                <button type="button" class="btn btn-sm btn-outline-primary" onclick="window.print()">
                    <i class="bi bi-printer"></i> Print
                </button>
            </div>
        </div>
    </div>

    @if (Model.SelectedDate.Date == DateTime.Today)
    {
        <div class="alert alert-info">
            <i class="bi bi-calendar-day"></i> <strong>Today's Schedule</strong>
        </div>
    }

    <!-- Summary Card -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-3">
                            <h3 class="text-primary mb-0">@Model.Substitutions.Count</h3>
                            <small class="text-muted">Total Substitutions</small>
                        </div>
                        <div class="col-md-3">
                            <h3 class="text-success mb-0">@Model.Substitutions.Count(s => s.Type == SubstitutionType.TeacherSubstitute)</h3>
                            <small class="text-muted">Teacher Coverage</small>
                        </div>
                        <div class="col-md-3">
                            <h3 class="text-warning mb-0">@Model.Substitutions.Count(s => s.Type == SubstitutionType.SelfStudy)</h3>
                            <small class="text-muted">Self-Study</small>
                        </div>
                        <div class="col-md-3">
                            <h3 class="text-danger mb-0">@Model.Substitutions.Count(s => s.Type == SubstitutionType.Cancelled)</h3>
                            <small class="text-muted">Cancelled</small>
                        </div>
                    </div>
                    @if (Model.UncoveredSupervisionDuties.Any() || Model.CoveredSupervisionDuties.Any())
                    {
                        <hr class="my-3" />
                        <div class="row text-center">
                            @if (Model.UncoveredSupervisionDuties.Any())
                            {
                                <div class="col-md-6">
                                    <h4 class="text-warning mb-0">
                                        <i class="bi bi-shield-exclamation"></i> @Model.UncoveredSupervisionDuties.Count
                                    </h4>
                                    <small class="text-muted">Uncovered Supervision</small>
                                </div>
                            }
                            @if (Model.CoveredSupervisionDuties.Any())
                            {
                                <div class="col-md-6">
                                    <h4 class="text-success mb-0">
                                        <i class="bi bi-shield-check"></i> @Model.CoveredSupervisionDuties.Count
                                    </h4>
                                    <small class="text-muted">Covered Supervision</small>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Absences Grid -->
    @if (Model.Absences.Any())
    {
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                    <i class="bi bi-calendar-x"></i> Teacher Absences
                    <span class="badge bg-light text-dark ms-2">@Model.Absences.Count</span>
                </h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Teacher</th>
                                <th>Time</th>
                                <th>Type</th>
                                <th>Status</th>
                                <th>Notes</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var absence in Model.Absences)
                            {
                                <tr>
                                    <td><strong>@absence.TeacherName</strong></td>
                                    <td>
                                        @if (absence.StartTime.HasValue && absence.EndTime.HasValue)
                                        {
                                            <span>@absence.StartTime?.ToString(@"hh\:mm") - @absence.EndTime?.ToString(@"hh\:mm")</span>
                                        }
                                        else
                                        {
                                            <span class="text-muted">All Day</span>
                                        }
                                    </td>
                                    <td>
                                        <span class="badge bg-secondary">@absence.Type</span>
                                    </td>
                                    <td>
                                        @{
                                            var statusBadge = absence.StatusEnum switch
                                            {
                                                AbsenceStatus.Reported => "bg-warning text-dark",
                                                AbsenceStatus.Confirmed => "bg-info",
                                                AbsenceStatus.BeingCovered => "bg-primary",
                                                AbsenceStatus.Covered => "bg-success",
                                                AbsenceStatus.PartiallyCovered => "bg-warning",
                                                AbsenceStatus.NotCovered => "bg-danger",
                                                _ => "bg-secondary"
                                            };
                                        }
                                        <span class="badge @statusBadge">@absence.Status</span>
                                    </td>
                                    <td>
                                        @if (!string.IsNullOrEmpty(absence.Notes))
                                        {
                                            <span title="@absence.Notes">
                                                @(absence.Notes.Length > 30 ? absence.Notes.Substring(0, 30) + "..." : absence.Notes)
                                            </span>
                                        }
                                        else
                                        {
                                            <span class="text-muted">-</span>
                                        }
                                    </td>
                                    <td>
                                        <div class="btn-group btn-group-sm" role="group">
                                            @if (Model.PublishedTimetableId.HasValue)
                                            {
                                                <a href="/Admin/Timetables/Edit/@Model.PublishedTimetableId?teacherId=@absence.TeacherId"
                                                   class="btn btn-outline-info"
                                                   title="View Teacher Schedule">
                                                    <i class="bi bi-calendar3"></i>
                                                </a>
                                            }
                                            <a href="/Admin/Absences/FindSubstitutes?id=@absence.Id"
                                               class="btn btn-outline-primary"
                                               title="Find Substitutes">
                                                <i class="bi bi-person-plus"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="card shadow-sm mb-4">
            <div class="card-body text-center py-5">
                <i class="bi bi-calendar-check" style="font-size: 4rem; color: #28a745;"></i>
                <h4 class="mt-3">No Absences</h4>
                <p class="text-muted">All teachers are present for this day.</p>
                <a href="/Admin/Absences/Report?date=@Model.SelectedDate.ToString("yyyy-MM-dd")" class="btn btn-primary mt-2">
                    <i class="bi bi-plus-circle"></i> Report an Absence
                </a>
            </div>
        </div>
    }

    <!-- Uncovered Break Supervision Duties -->
    @if (Model.UncoveredSupervisionDuties.Any())
    {
        <div class="card shadow-sm mb-4 border-warning">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">
                    <i class="bi bi-shield-exclamation"></i> Uncovered Break Supervision Duties
                    <span class="badge bg-dark text-white ms-2">@Model.UncoveredSupervisionDuties.Count</span>
                </h5>
            </div>
            <div class="card-body p-0">
                <div class="alert alert-warning mb-0 rounded-0 border-0">
                    <i class="bi bi-exclamation-triangle"></i>
                    The following break supervision duties need coverage due to teacher absences.
                </div>
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Absent Teacher</th>
                                <th>Break Slot</th>
                                <th>Location</th>
                                <th>Absence Type</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var duty in Model.UncoveredSupervisionDuties)
                            {
                                <tr>
                                    <td><strong>@duty.AbsentTeacher</strong></td>
                                    <td>
                                        <span class="badge bg-light text-dark border">
                                            <i class="bi bi-cup-hot"></i> @Model.GetBreakLabel(duty.PeriodNumber)
                                        </span>
                                    </td>
                                    <td>
                                        <span class="badge bg-secondary">
                                            <i class="bi bi-geo-alt"></i> @duty.Location
                                        </span>
                                    </td>
                                    <td>
                                        <span class="badge bg-info">@duty.AbsenceType</span>
                                    </td>
                                    <td>
                                        <a href="/Admin/Absences/FindSubstitutes?id=@duty.AbsenceId"
                                           class="btn btn-sm btn-outline-primary"
                                           title="Find Substitute">
                                            <i class="bi bi-person-plus"></i>
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card-footer bg-light">
                <small class="text-muted">
                    <i class="bi bi-info-circle"></i>
                    Click <i class="bi bi-person-plus"></i> to assign a substitute for supervision duties.
                </small>
            </div>
        </div>
    }

    <!-- Covered Break Supervision Duties -->
    @if (Model.CoveredSupervisionDuties.Any())
    {
        <div class="card shadow-sm mb-4 border-success">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">
                    <i class="bi bi-shield-check"></i> Covered Break Supervision Duties
                    <span class="badge bg-light text-dark ms-2">@Model.CoveredSupervisionDuties.Count</span>
                </h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Absent Teacher</th>
                                <th>Break Slot</th>
                                <th>Location</th>
                                <th>Coverage</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var duty in Model.CoveredSupervisionDuties)
                            {
                                <tr>
                                    <td><strong>@duty.AbsentTeacher</strong></td>
                                    <td>
                                        <span class="badge bg-light text-dark border">
                                            <i class="bi bi-cup-hot"></i> @Model.GetBreakLabel(duty.PeriodNumber)
                                        </span>
                                    </td>
                                    <td>
                                        <span class="badge bg-light text-dark border">
                                            <i class="bi bi-geo-alt"></i> @duty.Location
                                        </span>
                                    </td>
                                    <td>
                                        @if (duty.Type == SupervisionSubstitutionType.TeacherSubstitute)
                                        {
                                            <span class="badge bg-success">
                                                <i class="bi bi-person-check"></i> @duty.SubstituteTeacher
                                            </span>
                                        }
                                        else if (duty.Type == SupervisionSubstitutionType.Cancelled)
                                        {
                                            <span class="badge bg-danger">
                                                <i class="bi bi-x-circle"></i> Cancelled
                                            </span>
                                        }
                                        else if (duty.Type == SupervisionSubstitutionType.CombinedArea)
                                        {
                                            <span class="badge bg-info">
                                                <i class="bi bi-arrow-left-right"></i> Combined Area
                                            </span>
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    }

    <!-- Substitutions Accordion -->
    @if (Model.SubstitutionsByTeacher.Any() || Model.SubstitutionsBySubstitute.Any())
    {
        <!-- Print Header (visible only in print) -->
        <div class="print-header d-none d-print-block mb-3">
            <h3 class="text-center">Substitution Board - @Model.SelectedDate.ToString("dddd, MMMM dd, yyyy")</h3>
        </div>

        <div class="accordion d-print-none" id="substitutionAccordion">
            <!-- By Substitute Teacher -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingSubstitute">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSubstitute" aria-expanded="true" aria-controls="collapseSubstitute">
                        <i class="bi bi-person-check me-2"></i> By Substitute Teacher
                        <span class="badge bg-primary ms-2">@Model.SubstitutionsBySubstitute.Count</span>
                    </button>
                </h2>
                <div id="collapseSubstitute" class="accordion-collapse collapse show" aria-labelledby="headingSubstitute" data-bs-parent="#substitutionAccordion">
                    <div class="accordion-body p-2">
                        @foreach (var substituteGroup in Model.SubstitutionsBySubstitute)
                        {
                            var substituteTeacher = substituteGroup.Key;
                            var subs = substituteGroup.Value;
                            var isSpecialType = substituteTeacher == "Self-Study" || substituteTeacher == "Cancelled";

                            <div class="teacher-substitution-block mb-3">
                                <h4 class="teacher-header @(isSpecialType ? "bg-secondary" : "bg-success") text-white p-2 mb-0">
                                    <i class="bi @(isSpecialType ? "bi-info-circle" : "bi-person-check")"></i> @substituteTeacher
                                    <span class="badge bg-light text-dark ms-2">@subs.Count lesson(s)</span>
                                </h4>
                                <div class="table-responsive">
                                    <table class="table table-bordered table-striped mb-0 substitution-table">
                                        <thead class="table-light">
                                            <tr>
                                                <th style="width: 25%;">Absent Teacher</th>
                                                <th style="width: 15%;">Period</th>
                                                <th style="width: 25%;">Subject</th>
                                                <th style="width: 20%;">Class</th>
                                                <th style="width: 15%;">Room</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var sub in subs)
                                            {
                                                <tr>
                                                    <td>@sub.OriginalTeacher</td>
                                                    <td>@sub.PeriodNumber</td>
                                                    <td>@sub.Subject</td>
                                                    <td>@sub.Class</td>
                                                    <td>@sub.Room</td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- By Absent Teacher -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingAbsent">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAbsent" aria-expanded="false" aria-controls="collapseAbsent">
                        <i class="bi bi-person-x me-2"></i> By Absent Teacher
                        <span class="badge bg-danger ms-2">@Model.SubstitutionsByTeacher.Count</span>
                    </button>
                </h2>
                <div id="collapseAbsent" class="accordion-collapse collapse" aria-labelledby="headingAbsent" data-bs-parent="#substitutionAccordion">
                    <div class="accordion-body p-2">
                        @foreach (var teacherGroup in Model.SubstitutionsByTeacher)
                        {
                            var absentTeacher = teacherGroup.Key;
                            var subs = teacherGroup.Value;

                            <div class="teacher-substitution-block mb-3">
                                <h4 class="teacher-header bg-dark text-white p-2 mb-0">
                                    <i class="bi bi-person-x"></i> @absentTeacher
                                    <span class="badge bg-light text-dark ms-2">@subs.Count lesson(s)</span>
                                </h4>
                                <div class="table-responsive">
                                    <table class="table table-bordered table-striped mb-0 substitution-table">
                                        <thead class="table-light">
                                            <tr>
                                                <th style="width: 25%;">Substitute</th>
                                                <th style="width: 15%;">Period</th>
                                                <th style="width: 25%;">Subject</th>
                                                <th style="width: 20%;">Class</th>
                                                <th style="width: 15%;">Room</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var sub in subs)
                                            {
                                                <tr>
                                                    <td>
                                                        @if (sub.Type == SubstitutionType.TeacherSubstitute)
                                                        {
                                                            <strong>@sub.SubstituteTeacher</strong>
                                                        }
                                                        else if (sub.Type == SubstitutionType.SelfStudy)
                                                        {
                                                            <span class="text-warning"><strong>Self-Study</strong></span>
                                                        }
                                                        else if (sub.Type == SubstitutionType.Cancelled)
                                                        {
                                                            <span class="text-danger"><strong>Cancelled</strong></span>
                                                        }
                                                        else
                                                        {
                                                            <span>@sub.TypeDisplay</span>
                                                        }
                                                    </td>
                                                    <td>@sub.PeriodNumber</td>
                                                    <td>@sub.Subject</td>
                                                    <td>@sub.Class</td>
                                                    <td>@sub.Room</td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- Print Buttons -->
        <div class="d-print-none mt-3 mb-3">
            <div class="btn-group" role="group" aria-label="Print options">
                <button type="button" class="btn btn-outline-success" onclick="printView('substitute')">
                    <i class="bi bi-printer"></i> Print by Substitute
                </button>
                <button type="button" class="btn btn-outline-dark" onclick="printView('absent')">
                    <i class="bi bi-printer"></i> Print by Absent Teacher
                </button>
            </div>
        </div>

        <!-- Print-Only Sections (hidden on screen, shown in print based on selection) -->
        <div id="printSubstituteSection" class="d-none d-print-block substitution-print-section">
            @foreach (var substituteGroup in Model.SubstitutionsBySubstitute)
            {
                var substituteTeacher = substituteGroup.Key;
                var subs = substituteGroup.Value;

                <div class="teacher-substitution-block mb-4">
                    <h4 class="teacher-header bg-success text-white p-2 mb-0">
                        @substituteTeacher
                    </h4>
                    <table class="table table-bordered table-striped mb-0 substitution-table">
                        <thead class="table-light">
                            <tr>
                                <th>Absent Teacher</th>
                                <th>Period</th>
                                <th>Subject</th>
                                <th>Class</th>
                                <th>Room</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var sub in subs)
                            {
                                <tr>
                                    <td>@sub.OriginalTeacher</td>
                                    <td>@sub.PeriodNumber</td>
                                    <td>@sub.Subject</td>
                                    <td>@sub.Class</td>
                                    <td>@sub.Room</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>

        <div id="printAbsentSection" class="d-none substitution-print-section">
            @foreach (var teacherGroup in Model.SubstitutionsByTeacher)
            {
                var absentTeacher = teacherGroup.Key;
                var subs = teacherGroup.Value;

                <div class="teacher-substitution-block mb-4">
                    <h4 class="teacher-header bg-dark text-white p-2 mb-0">
                        @absentTeacher
                    </h4>
                    <table class="table table-bordered table-striped mb-0 substitution-table">
                        <thead class="table-light">
                            <tr>
                                <th>Substitute</th>
                                <th>Period</th>
                                <th>Subject</th>
                                <th>Class</th>
                                <th>Room</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var sub in subs)
                            {
                                <tr>
                                    <td>
                                        @if (sub.Type == SubstitutionType.TeacherSubstitute)
                                        {
                                            @sub.SubstituteTeacher
                                        }
                                        else
                                        {
                                            @sub.TypeDisplay
                                        }
                                    </td>
                                    <td>@sub.PeriodNumber</td>
                                    <td>@sub.Subject</td>
                                    <td>@sub.Class</td>
                                    <td>@sub.Room</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>
    }
    else
    {
        <div class="card shadow-sm">
            <div class="card-body text-center py-5">
                <i class="bi bi-calendar-check" style="font-size: 4rem; color: #28a745;"></i>
                <h4 class="mt-3">No Substitutions Scheduled</h4>
                <p class="text-muted">All teachers are present for this day. No substitutes needed!</p>
                <a href="/Admin/Absences/Report?date=@Model.SelectedDate.ToString("yyyy-MM-dd")" class="btn btn-primary mt-2">
                    <i class="bi bi-plus-circle"></i> Report an Absence
                </a>
            </div>
        </div>
    }
</div>

@section Styles {
    <style>
        /* Screen styles */
        .teacher-header {
            font-size: 1.1rem;
            border-radius: 4px 4px 0 0;
        }
        .substitution-table {
            font-size: 0.95rem;
        }
        .substitution-table th {
            font-weight: 600;
            background-color: #f8f9fa;
        }
        .teacher-substitution-block {
            border: 1px solid #dee2e6;
            border-radius: 4px;
        }
        .accordion-button:not(.collapsed) {
            font-weight: 600;
        }

        /* Print styles */
        @@media print {
            /* Hide navigation and action elements */
            .btn, .breadcrumb, nav, .alert,
            .card.shadow-sm.mb-4:first-of-type,
            .d-print-none, .accordion {
                display: none !important;
            }

            /* Show print header */
            .print-header {
                display: block !important;
            }

            /* Reset container for full width */
            .container-fluid {
                padding: 0 !important;
                margin: 0 !important;
            }

            /* Teacher header styling for print */
            .teacher-header {
                background-color: #333 !important;
                color: white !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                padding: 8px 12px !important;
                font-size: 14pt !important;
                margin-bottom: 0 !important;
                border-radius: 0 !important;
            }
            .teacher-header.bg-success {
                background-color: #198754 !important;
            }
            .teacher-header.bg-dark {
                background-color: #212529 !important;
            }

            /* Table styling for print */
            .substitution-table {
                width: 100% !important;
                border-collapse: collapse !important;
                font-size: 11pt !important;
            }
            .substitution-table th,
            .substitution-table td {
                border: 1px solid #000 !important;
                padding: 6px 8px !important;
            }
            .substitution-table th {
                background-color: #e9ecef !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                font-weight: bold !important;
            }
            .substitution-table tbody tr:nth-child(even) {
                background-color: #f8f9fa !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            /* Prevent page breaks inside teacher blocks */
            .teacher-substitution-block {
                break-inside: avoid;
                page-break-inside: avoid;
                margin-bottom: 20px !important;
                border: none !important;
            }

            /* Remove shadows and decorations */
            .card, .shadow-sm {
                box-shadow: none !important;
                border: none !important;
            }

            /* Hide summary cards in print */
            .row.mb-4 > .col-md-12 > .card {
                display: none !important;
            }

            /* Print section visibility controlled by JS class */
            .substitution-print-section {
                display: none !important;
            }
            .substitution-print-section.print-active {
                display: block !important;
            }
        }
    </style>
}

@section Scripts {
    <script>
        // Print the selected view
        function printView(view) {
            const substituteSection = document.getElementById('printSubstituteSection');
            const absentSection = document.getElementById('printAbsentSection');

            // Set which section to print
            if (view === 'substitute') {
                substituteSection.classList.add('print-active');
                absentSection.classList.remove('print-active');
            } else {
                substituteSection.classList.remove('print-active');
                absentSection.classList.add('print-active');
            }

            // Small delay to ensure CSS is applied, then print
            setTimeout(function() {
                window.print();
            }, 100);
        }
    </script>
}
