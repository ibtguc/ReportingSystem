@*
DISABLED: Teachers do not have access to the system
This page is commented out for future use when/if teacher self-service is implemented
Administrators manage all substitutions through /Admin routes
*@

@*
@page
@model SchedulingSystem.Pages.Teachers.MySubstitutionsModel
@{
    ViewData["Title"] = "My Substitutions";
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-md-12">
            <h2><i class="bi bi-person-badge"></i> My Substitutions</h2>
            @if (!string.IsNullOrEmpty(Model.TeacherName))
            {
                <p class="lead">Welcome, <strong>@Model.TeacherName</strong></p>
            }
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/Admin/Dashboard">Dashboard</a></li>
                    <li class="breadcrumb-item active">My Substitutions</li>
                </ol>
            </nav>
        </div>
    </div>

    @if (Model.TeacherId.HasValue)
    {
        <!-- Status Card -->
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card shadow-sm border-@(Model.Stats.IsActive ? "success" : "secondary")">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h5 class="mb-0">
                                    Status:
                                    @if (Model.Stats.IsActive)
                                    {
                                        <span class="badge bg-success">Active</span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-secondary">Inactive</span>
                                    }
                                </h5>
                                <p class="text-muted mb-0">
                                    @if (Model.Stats.IsActive)
                                    {
                                        <span>You are available for substitution assignments.</span>
                                    }
                                    else
                                    {
                                        <span>You are currently not available for assignments. Contact administration to update your status.</span>
                                    }
                                </p>
                            </div>
                            <div class="text-end">
                                <h3 class="mb-0">@Model.Stats.TotalThisWeek / @Model.Stats.MaxSubstitutionsPerWeek</h3>
                                <small class="text-muted">Substitutions this week</small>
                                <div class="progress mt-2" style="width: 200px;">
                                    <div class="progress-bar @(Model.Stats.CapacityPercentage >= 100 ? "bg-danger" : Model.Stats.CapacityPercentage >= 80 ? "bg-warning" : "bg-success")"
                                         role="progressbar" style="width: @Model.Stats.CapacityPercentage%"
                                         aria-valuenow="@Model.Stats.CapacityPercentage" aria-valuemin="0" aria-valuemax="100">
                                        @Model.Stats.CapacityPercentage.ToString("F0")%
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card shadow-sm border-primary">
                    <div class="card-body text-center">
                        <h3 class="text-primary mb-0">@Model.Stats.TotalThisWeek</h3>
                        <p class="text-muted mb-0 small">This Week</p>
                        <small class="text-muted">@Model.Stats.HoursThisWeek.ToString("F1") hours</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card shadow-sm border-info">
                    <div class="card-body text-center">
                        <h3 class="text-info mb-0">@Model.Stats.TotalThisMonth</h3>
                        <p class="text-muted mb-0 small">This Month</p>
                        <small class="text-muted">@Model.Stats.HoursThisMonth.ToString("F1") hours</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card shadow-sm border-success">
                    <div class="card-body text-center">
                        <h3 class="text-success mb-0">$@Model.Stats.EarningsThisMonth.ToString("N2")</h3>
                        <p class="text-muted mb-0 small">Earnings This Month</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card shadow-sm border-warning">
                    <div class="card-body text-center">
                        <h3 class="text-warning mb-0">@Model.Stats.TotalAllTime</h3>
                        <p class="text-muted mb-0 small">Total All Time</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Upcoming Substitutions -->
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-calendar-event"></i> Upcoming Substitutions
                            <span class="badge bg-light text-dark ms-2">@Model.UpcomingSubstitutions.Count</span>
                        </h5>
                    </div>
                    <div class="card-body p-0">
                        @if (Model.UpcomingSubstitutions.Any())
                        {
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Date</th>
                                            <th>Day</th>
                                            <th>Time</th>
                                            <th>Subject</th>
                                            <th>Class</th>
                                            <th>Room</th>
                                            <th>For</th>
                                            <th>Reason</th>
                                            <th>Hours</th>
                                            <th>Pay</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var sub in Model.UpcomingSubstitutions)
                                        {
                                            var isToday = sub.Date == DateTime.Today;
                                            <tr class="@(isToday ? "table-warning" : "")">
                                                <td>
                                                    <strong>@sub.Date.ToString("MMM dd")</strong>
                                                    @if (isToday)
                                                    {
                                                        <span class="badge bg-warning text-dark ms-1">TODAY</span>
                                                    }
                                                </td>
                                                <td>@sub.DayOfWeek</td>
                                                <td class="small">@sub.PeriodTime</td>
                                                <td><strong>@sub.Subject</strong></td>
                                                <td><span class="badge bg-info">@sub.Class</span></td>
                                                <td>@sub.Room</td>
                                                <td>@sub.OriginalTeacher</td>
                                                <td><span class="badge bg-secondary">@sub.AbsenceReason</span></td>
                                                <td>@sub.Hours.ToString("F1")</td>
                                                <td>
                                                    @if (sub.Pay.HasValue)
                                                    {
                                                        <span class="text-success">$@sub.Pay.Value.ToString("F2")</span>
                                                    }
                                                    else
                                                    {
                                                        <span class="text-muted">N/A</span>
                                                    }
                                                </td>
                                            </tr>
                                            @if (!string.IsNullOrEmpty(sub.Notes))
                                            {
                                                <tr class="@(isToday ? "table-warning" : "")">
                                                    <td colspan="10" class="small text-muted">
                                                        <i class="bi bi-info-circle"></i> <strong>Notes:</strong> @sub.Notes
                                                    </td>
                                                </tr>
                                            }
                                        }
                                    </tbody>
                                </table>
                            </div>
                        }
                        else
                        {
                            <div class="text-center py-5">
                                <i class="bi bi-calendar-x" style="font-size: 3rem; color: #ccc;"></i>
                                <p class="text-muted mt-3">No upcoming substitutions scheduled.</p>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- Past Substitutions (Last 30 Days) -->
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-clock-history"></i> Recent History (Last 30 Days)
                            <span class="badge bg-light text-dark ms-2">@Model.PastSubstitutions.Count</span>
                        </h5>
                    </div>
                    <div class="card-body p-0">
                        @if (Model.PastSubstitutions.Any())
                        {
                            <div class="table-responsive">
                                <table class="table table-hover table-sm mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Date</th>
                                            <th>Subject</th>
                                            <th>Class</th>
                                            <th>Hours</th>
                                            <th>Pay</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var sub in Model.PastSubstitutions)
                                        {
                                            <tr>
                                                <td>@sub.Date.ToString("MMM dd, yyyy")</td>
                                                <td>@sub.Subject</td>
                                                <td>@sub.Class</td>
                                                <td>@sub.Hours.ToString("F1")</td>
                                                <td>
                                                    @if (sub.Pay.HasValue)
                                                    {
                                                        <span>$@sub.Pay.Value.ToString("F2")</span>
                                                    }
                                                    else
                                                    {
                                                        <span class="text-muted">N/A</span>
                                                    }
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                    <tfoot class="table-light">
                                        <tr>
                                            <td colspan="3" class="text-end"><strong>Totals:</strong></td>
                                            <td><strong>@Model.PastSubstitutions.Sum(s => s.Hours).ToString("F1")</strong></td>
                                            <td><strong class="text-success">$@Model.PastSubstitutions.Sum(s => s.Pay ?? 0).ToString("N2")</strong></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        }
                        else
                        {
                            <div class="text-center py-4">
                                <p class="text-muted">No substitutions in the last 30 days.</p>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- Help & Contact -->
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card shadow-sm bg-light">
                    <div class="card-body">
                        <h6><i class="bi bi-question-circle"></i> Need Help?</h6>
                        <p class="mb-0">
                            If you have questions about your assignments or need to update your availability,
                            please contact the school administration office.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <!-- No Teacher Selected -->
        <div class="row">
            <div class="col-md-12">
                <div class="alert alert-info">
                    <h5><i class="bi bi-info-circle"></i> Teacher Dashboard</h5>
                    <p class="mb-0">
                        This page displays your substitution assignments and statistics.
                        In a production environment, this would automatically load based on your login credentials.
                    </p>
                </div>
                <div class="card shadow-sm">
                    <div class="card-body text-center py-5">
                        <i class="bi bi-person-circle" style="font-size: 4rem; color: #ccc;"></i>
                        <p class="text-muted mt-3">Demo Mode: Add <code>?teacherId=X</code> to the URL to view a teacher's dashboard.</p>
                    </div>
                </div>
            </div>
        </div>
    }
</div>
*@
